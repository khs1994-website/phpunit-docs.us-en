
<!DOCTYPE HTML>
<html lang="us-en" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Extending Phpunit · PHPUnit 英文文档</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-prism/prism-solarizedlight.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="fixtures.html" />
    
    
    <link rel="prev" href="copyright.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    
    
        
        <li>
            <a href="https://docs.khs1994.com" target="_blank" class="custom-link">Home</a>
        </li>
    
    

    
    <li class="divider"></li>
    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="annotations.html">
            
                <a href="annotations.html">
            
                    
                    Annotations
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="assertions.html">
            
                <a href="assertions.html">
            
                    
                    Assertions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="bibliography.html">
            
                <a href="bibliography.html">
            
                    
                    Bibliography
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="code-coverage-analysis.html">
            
                <a href="code-coverage-analysis.html">
            
                    
                    Code Coverage Analysis
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="configuration.html">
            
                <a href="configuration.html">
            
                    
                    Configuration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="copyright.html">
            
                <a href="copyright.html">
            
                    
                    Copyright
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.8" data-path="extending-phpunit.html">
            
                <a href="extending-phpunit.html">
            
                    
                    Extending Phpunit
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="fixtures.html">
            
                <a href="fixtures.html">
            
                    
                    Fixtures
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="incomplete-and-skipped-tests.html">
            
                <a href="incomplete-and-skipped-tests.html">
            
                    
                    Incomplete And Skipped Tests
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="installation.html">
            
                <a href="installation.html">
            
                    
                    Installation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="organizing-tests.html">
            
                <a href="organizing-tests.html">
            
                    
                    Organizing Tests
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="risky-tests.html">
            
                <a href="risky-tests.html">
            
                    
                    Risky Tests
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="test-doubles.html">
            
                <a href="test-doubles.html">
            
                    
                    Test Doubles
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15" data-path="textui.html">
            
                <a href="textui.html">
            
                    
                    Textui
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16" data-path="writing-tests-for-phpunit.html">
            
                <a href="writing-tests-for-phpunit.html">
            
                    
                    Writing Tests For Phpunit
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Extending Phpunit</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="extending-phpunit">Extending PHPUnit</h1>
<p>PHPUnit can be extended in various ways to make the writing of tests
easier and customize the feedback you get from running tests. Here are
common starting points to extend PHPUnit.</p>
<h2 id="subclass-phpunitframeworktestcase">Subclass PHPUnit\Framework\TestCase</h2>
<p>Write custom assertions and utility methods in an abstract subclass of
<code>PHPUnit\Framework\TestCase</code> and derive your test case classes from that
class. This is one of the easiest ways to extend PHPUnit.</p>
<h2 id="write-custom-assertions">Write custom assertions</h2>
<p>When writing custom assertions it is the best practice to follow how
PHPUnit&apos;s own assertions are implemented. As you can see in
<code>extending-phpunit.examples.Assert.php</code>, the <code>assertTrue()</code> method is a
wrapper around the <code>isTrue()</code> and <code>assertThat()</code> methods: <code>isTrue()</code>
creates a matcher object that is passed on to <code>assertThat()</code> for
evaluation.</p>
<pre class="language-"><code>&lt;?php declare(strict_types=1);
namespace PHPUnit\Framework;

use PHPUnit\Framework\Constraint\IsTrue;

abstract class Assert
{
    // ...

    public static function assertTrue($condition, string $message = &apos;&apos;): void
    {
        static::assertThat($condition, static::isTrue(), $message);
    }

    // ...

    public static function isTrue(): IsTrue
    {
        return new IsTrue;
    }

    // ...
}
</code></pre><p><code>extending-phpunit.examples.IsTrue.php</code> shows how
<code>PHPUnit\Framework\Constraint\IsTrue</code> extends the abstract base class
for matcher objects (or constraints), <code>PHPUnit\Framework\Constraint</code>.</p>
<pre class="language-"><code>&lt;?php declare(strict_types=1);
namespace PHPUnit\Framework\Constraint;

use PHPUnit\Framework\Constraint;

final class IsTrue extends Constraint
{
    public function toString(): string
    {
        return &apos;is true&apos;;
    }

    protected function matches($other): bool
    {
        return $other === true;
    }
}
</code></pre><p>The effort of implementing the <code>assertTrue()</code> and <code>isTrue()</code> methods as
well as the <code>PHPUnit\Framework\Constraint\IsTrue</code> class yields the
benefit that <code>assertThat()</code> automatically takes care of evaluating the
assertion and bookkeeping tasks such as counting it for statistics.
Furthermore, the <code>isTrue()</code> method can be used as a matcher when
configuring mock objects.</p>
<h2 id="extending-the-testrunner">Extending the TestRunner</h2>
<p>PHPUnit&apos;s test runner can be extended by registering objects that
implement one or more of the following interfaces:</p>
<ul>
<li><code>AfterIncompleteTestHook</code></li>
<li><code>AfterLastTestHook</code></li>
<li><code>AfterRiskyTestHook</code></li>
<li><code>AfterSkippedTestHook</code></li>
<li><code>AfterSuccessfulTestHook</code></li>
<li><code>AfterTestErrorHook</code></li>
<li><code>AfterTestFailureHook</code></li>
<li><code>AfterTestWarningHook</code></li>
<li><code>AfterTestHook</code></li>
<li><code>BeforeFirstTestHook</code></li>
<li><code>BeforeTestHook</code></li>
</ul>
<p>Each &quot;hook&quot;, meaning each of the interfaces listed above, represents an
event that can occur while the tests are being executed.</p>
<p>See <code>appendixes.configuration.extensions</code> for details on how to register
extensions in PHPUnit&apos;s XML configuration.</p>
<p><code>extending-phpunit.examples.TestRunnerExtension</code> shows an example for an
extension implementing <code>BeforeFirstTestHook</code> and <code>AfterLastTestHook</code>:</p>
<pre class="language-"><code>&lt;?php declare(strict_types=1);
namespace Vendor;

use PHPUnit\Runner\BeforeFirstTestHook;
use PHPUnit\Runner\AfterLastTestHook;

final class MyExtension implements BeforeFirstTestHook, AfterLastTestHook
{
    public function executeBeforeFirstTest(): void
    {
        // called before the first test is being run
    }

    public function executeAfterLastTest(): void
    {
        // called after the last test has been run
    }
}
</code></pre><h3 id="configuring-extensions">Configuring extensions</h3>
<p>You can configure PHPUnit extensions, assuming the extension accepts
configuration values.</p>
<p><code>extending-phpunit.examples.TestRunnerConfigurableExtension</code> shows an
example how to make an extension configurable, by adding an
<code>__constructor()</code> definition to the extension class:</p>
<pre class="language-"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>?php</span> <span class="token attr-name">declare(strict_types</span><span class="token attr-value"><span class="token punctuation">=</span>1);</span>
<span class="token attr-name">namespace</span> <span class="token attr-name">Vendor;</span>

<span class="token attr-name">use</span> <span class="token attr-name">PHPUnit\Runner\BeforeFirstTestHook;</span>
<span class="token attr-name">use</span> <span class="token attr-name">PHPUnit\Runner\AfterLastTestHook;</span>

<span class="token attr-name">final</span> <span class="token attr-name">class</span> <span class="token attr-name">MyConfigurableExtension</span> <span class="token attr-name">implements</span> <span class="token attr-name">BeforeFirstTestHook,</span> <span class="token attr-name">AfterLastTestHook</span>
<span class="token attr-name">{</span>
    <span class="token attr-name">protected</span> <span class="token attr-name">$config_value_1</span> <span class="token attr-value"><span class="token punctuation">=</span> <span class="token punctuation">&apos;</span><span class="token punctuation">&apos;</span></span><span class="token attr-name">;</span>

    <span class="token attr-name">protected</span> <span class="token attr-name">$config_value_2</span> <span class="token attr-value"><span class="token punctuation">=</span> 0;</span>

    <span class="token attr-name">public</span> <span class="token attr-name">function</span> <span class="token attr-name">__construct(string</span> <span class="token attr-name">$value1</span> <span class="token attr-value"><span class="token punctuation">=</span> <span class="token punctuation">&apos;</span><span class="token punctuation">&apos;</span></span><span class="token attr-name">,</span> <span class="token attr-name">int</span> <span class="token attr-name">$value2</span> <span class="token attr-value"><span class="token punctuation">=</span> 0)</span>
    <span class="token attr-name">{</span>
        <span class="token attr-name">$this-</span><span class="token punctuation">&gt;</span></span>config_value_1 = $config_1;
        $this-&gt;config_value_2 = $config_2;
    }

    public function executeBeforeFirstTest(): void
    {
        if (strlen($this-&gt;config_value_1) {
            echo &apos;Testing with configuration value: &apos; . $this-&gt;config_value_1;
        }
    }

    public function executeAfterLastTest(): void
    {
        if ($this-&gt;config_value_2 &gt; 10) {
            echo &apos;Second config value is OK!&apos;;
        }
    }
}
</code></pre><p>To input configuration to the extension via XML, the XML configuration
file&apos;s <code>extensions</code> section needs to be updated to have configuration
values, as shown in
<code>extending-phpunit.examples.TestRunnerConfigurableExtensionConfig</code>:</p>
<pre class="language-"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>extensions</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>extension</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Vendor\MyUnconfigurableExtension<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>extension</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Vendor\MyConfigurableExtension<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>arguments</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">&gt;</span></span>Hello world!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>int</span><span class="token punctuation">&gt;</span></span>15<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>int</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>arguments</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>extension</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>extensions</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>See <code>appendixes.configuration.extensions.extension.arguments</code> for
details on how to use the <code>arguments</code> configuration.</p>
<p>Remember: all configuration is optional, so make sure your extension
either has sane defaults in place, or that it disables itself in case
configuration is missing.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="copyright.html" class="navigation navigation-prev " aria-label="Previous page: Copyright">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="fixtures.html" class="navigation navigation-next " aria-label="Next page: Fixtures">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Extending Phpunit","level":"1.8","depth":1,"next":{"title":"Fixtures","level":"1.9","depth":1,"path":"fixtures.md","ref":"fixtures.md","articles":[]},"previous":{"title":"Copyright","level":"1.7","depth":1,"path":"copyright.md","ref":"copyright.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-sharing","-highlight","-livereload","prism"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"prism":{"css":["prismjs/themes/prism-solarizedlight.css"]},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"PHPUnit 英文文档","language":"us-en","links":{"sidebar":{"Home":"https://docs.khs1994.com"}},"gitbook":"*"},"file":{"path":"extending-phpunit.md","mtime":"2021-05-20T01:13:25.000Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2021-05-20T01:13:58.148Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

